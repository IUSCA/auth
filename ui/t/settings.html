<sca-menubar menu="top_menu" active="'user'" profile="public_profile"></sca-menubar>
<div class="header">
    <h2>Settings</h2>
</div>
<sca-menutab menu="settings_menu" active="'account'"></sca-menutab>
<div class="container-fluid">
    <!--<h3 class="page-header">Public Profile</h3>-->
    <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>
    <ul class="list-group settings">
        <!--
        <li class="list-group-item heading" ng-if="serverconf.local">
            <h4 class="list-group-item-heading">Login Tokens</h4>
        </li>
        -->
        <li class="list-group-item" ng-if="serverconf.local">
            <div class="form-group">
                <label>Username</label>
                <input type="text" class="form-control" ng-model="user.username" disabled/>
            </div>
            <div class="form-group">
                <label>Email</label>
                <p class="text-muted">An email address used to login to your account - maybe different from the current email address in your public profile.</p>
                <input type="text" class="form-control" ng-model="user.email" disabled/>
            </div>
            <p class="text-muted">Last Login: 
                <span ng-if="!user.times.local_login">Never</span>
                <time ng-if="user.times.local_login">{{user.times.local_login | date:'medium'}}</time>
            </p>
        </li>
        <li class="list-group-item heading" ng-if="serverconf.local">
            <h4 class="list-group-item-heading">Change Password</h4>
        </li>
        <li class="list-group-item" ng-if="serverconf.local">
            <form ng-submit="submit_password();">
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" class="form-control" ng-model="form_password.old" name="old" required/>
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" class="form-control" ng-model="form_password.new" name="new" required/>
                    <!-- see https://blogs.dropbox.com/tech/2012/04/zxcvbn-realistic-password-strength-estimation/ -->
                    <div ng-if="password_strength">
                        <span class="label label-danger" ng-if="password_strength.score == 0">Very Weak (cracks in {{password_strength.crack_time| number:0}} seconds)</span>
                        <span class="label label-warning" ng-if="password_strength.score == 1">Weak (cracks in {{password_strength.crack_time| number:0}} seconds)</span>
                        <span class="label label-warning" ng-if="password_strength.score == 2">OK (cracks in {{password_strength.crack_time| number:0}} seconds)</span>
                        <span class="label label-success" ng-if="password_strength.score == 3">Strong (cracks in {{password_strength.crack_time| number:0}} seconds)</span>
                        <span class="label label-success" ng-if="password_strength.score == 4">Very Strong (cracks in {{password_strength.crack_time| number:0}} seconds)</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" class="form-control" ng-model="form_password.new_confirm" name="new_confirm" required/>
                    <div class="alert alert-warning" ng-if="form_password.new_confirm && form_password.new != form_password.new_confirm">Password does not match!</div>
                </div>
                <a class="pull-right" href="#/forgotpass">I forgot my password</a>
                <input type="submit" class="btn" value="Update Password"/>
            </form><!--profile form-->
        </li>
        <li class="list-group-item heading">
            <h4 class="list-group-item-heading">Connected Accounts</h4>
        </li>
        <li class="list-group-item">
            <form>
                <div class="well" ng-if="serverconf.iucas">
                    <img src="images/iu.account_logo.png" class="account pull-left" style="padding-right: 10px;">
                    <button class="btn pull-right" ng-if="user.iucas" ng-click="disconnect('iucas')">Disconnect</button>
                    <button class="btn pull-right" ng-if="!user.iucas" ng-click="iucas_connect()">Connect</button>
                    <p class="pull-right text-muted" style="margin: 11px;">
                        <span ng-if="user.iucas"><b>{{user.iucas}}</b> |</span>
                        Last Login: 
                        <span ng-if="!user.times.iucas_login">Never</span>
                        <time ng-if="user.times.iucas_login">{{user.times.iucas_login | date:'medium'}}</time>
                    </p>
                    <h4>Indiana University CAS</h4>
                </div> 
                <div class="well" ng-if="serverconf.git">
                    <span class="pull-left">Git</span>
                    <button class="btn pull-right" ng-if="user.gitid" ng-click="disconnect('git')">Disconnect</button>
                    <button class="btn pull-right" ng-if="!user.gitid" ng-click="git_connect()">Connect</button>
                    <p class="pull-right text-muted" style="margin: 11px;">
                        <span ng-if="user.gitid"><b>{{user.gitid}}</b> |</span>
                        Last Login: 
                        <span ng-if="!user.times.github_login">Never</span>
                        <time ng-if="user.times.github_login">{{user.times.github_login | date:'medium'}}</time>
                    </p>
                    <h4>Git</h4>
                </div>
                <div class="well" ng-if="serverconf.google">
                    <img src="images/google.account_logo.png" class="account pull-left" style="padding-right: 10px;">
                    <button class="btn pull-right" ng-if="user.googleid" ng-click="disconnect('google')">Disconnect</button>
                    <button class="btn pull-right" ng-if="!user.googleid" ng-click="google_connect()">Connect</button>
                    <p class="pull-right text-muted" style="margin: 11px;">
                        <span ng-if="user.googleid"><b>{{user.googleid}}</b> |</span>
                        Last Login: 
                        <span ng-if="!user.times.google_login">Never</span>
                        <time ng-if="user.times.google_login">{{user.times.google_login | date:'medium'}}</time>
                    </p>
                    <h4>Google</h4>
                </div>
            </form>
        </li>
    </ul>
</div>

